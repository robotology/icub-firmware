/**
 * @file ipal_app_cfg.c
 * IPAL Configuration 
 */
#include "ipal_app_cfg.h"
#include "ipal_hal_eth_stm32h7.h"
#include "ipal_hal_eth_lwip_aux_functions.h"

/* ===============================================================================================
 * USER EXTERNAL FUNCTIONS
 * =============================================================================================== */
 
/*
 * Executed in case of fatal error
 */
static void ipal_app_on_fatal_error(ipal_fatalerror_t errorcode, const char * errormsg)
{
	/* Avoid compiler warnings*/ 
	errorcode = errorcode;
	errormsg = errormsg;
	
	while(1);
}

/* ===============================================================================================
 * IPAL CONFIGURATION
 * =============================================================================================== */
 
/* IPAL Configuration */
ipal_cfg_t ipal_app_cfg = 
{
	/* ............................................................................................
	 * ARCH
	 * ............................................................................................ */
	
	/* Underlying stack */
	.arch_ipstack = ipal_ipstack_iitmod_lwip,
	
	/* The used memory model */
	.memorymodel = ipal_memmodel_static,
	
	/* ............................................................................................
	 * SYS
	 * ............................................................................................ */
	
	/* Time tick - Gives an IPAL internal time granularity */
	.sys_timetick = 10000,
	
	/* Memory pool */
	.sys_mempoolsize = 0,
	
	/* ............................................................................................
	 * ETH
	 * ............................................................................................ */
	 
	.eth_isrpriority 	= 0,
	.eth_mac 					= IPAL_mac48addr(0x1E,0x30,0x6C,0xA2,0x45,0x5E),
#if defined(USE_PC104_ADDRESSING)
    .eth_ip 					= IPAL_ipv4addr(10, 0, 1, 1),
#warning using USE_PC104_ADDRESSING  
#else
	.eth_ip 					= IPAL_ipv4addr(192, 168, 0, 234),
#endif    
	.eth_mask 				= IPAL_ipv4addr(255, 255, 255, 0),
	
	/* ............................................................................................
	 * ARP: Not configured 
	 * ............................................................................................ */

	/* ............................................................................................
	 * IGMP 
	 * ............................................................................................ */
	
	.igmp_enable = ipal_false,
	
	/* ............................................................................................
	 * DHCP
	 * ............................................................................................ */
	
	.dhcp_enable = ipal_false,
	
	/* ............................................................................................
	 * UDP
	 * ............................................................................................ */
	
	.udp_enable = ipal_false,
	
	/* ............................................................................................
	 * TCP
	 * ............................................................................................ */
	
	.tcp_enable = ipal_false,
	
	/* ............................................................................................
	 * TFTP
	 * ............................................................................................ */
	
	.tftp_enable = ipal_false,
	
	/* ............................................................................................
	 * FTP
	 * ............................................................................................ */
	
	.ftp_enable = ipal_false,
	
	/* ............................................................................................
	 * TELNET
	 * ............................................................................................ */

	.tel_enable = ipal_false,
	
	
	/* --------------------------------------------------------------------------------------------
	 * External user function
	 * -------------------------------------------------------------------------------------------- */
	 
	.extfn = 
	{
		/* ..........................................................................................
		 * Error handling function
		 * .......................................................................................... */
		
		.usr_on_fatal_error = ipal_app_on_fatal_error,
		
		/* ..........................................................................................
		 * OSAL configuration
		 * .......................................................................................... */
	
		/* Locking system */
		.osal_mutex_new = NULL,
		.osal_mutex_take = NULL,
		.osal_mutex_release = NULL,
		
		/* Timeout forever */
		.osal_param_tout_forever = 0,
		
		/* Scheduling system */
		.osal_system_scheduling_suspend = NULL,
		.osal_system_scheduling_restart = NULL,
		
		/* ..........................................................................................
		 * HAL
		 * .......................................................................................... */

		.hal_eth_init 			= ipal_hal_eth_stm32h7_init,
		.hal_eth_enable 		= ipal_hal_eth_stm32h7_enable,
		.hal_eth_disable 		= ipal_hal_eth_stm32h7_disable,
		.hal_eth_sendframe 	= ipal_hal_eth_stm32h7_sendframe,
		
		/* ..........................................................................................
		 * PROCESS FRAME
		 * .......................................................................................... */

		.usr_on_ethframe_received = NULL
		
		/* All the other functions are not configured */
	}
	 
};

/* Auxiliary driver functions */
ipal_hal_eth_aux_functions_t ipal_hal_eth_aux_functions =
{
	/* Get frame size */
	.get_frame_size = ipal_hal_eth_stm32h7_get_frame_size,
	
	/* Get frame */
	.get_frame = ipal_hal_eth_stm32h7_get_frame, 
	
	/* Signal RX Frame */
	.signal_rx_frame = ipal_signal_rx_frame,
	
	/* Signal TX Frame */
	.signal_tx_frame = ipal_signal_tx_frame
};
